<%= image_tag @user.avatar, class: 'prof-pic-lg' %><h1 class="text-center">

<%= @user.username %></h1>

<p class="text-center lead"><%= @user.introduction %></p>

<ul class="user-stats">
  <li>
    <div class="number-label">Reviews</div>
    <div class="number-value"><%= @user.reviews.count %></div>
  </li>
</ul>
<div class="grid" id="reviewed-movies">
</div>

<script type="text/javascript">
  var $grid = $('.grid').masonry({
    // options
    itemSelector: '.grid-item',
    // use element for option
    columnWidth: 200,
    percentPosition: true
  });
  // layout Masonry after each image loads
  $grid.imagesLoaded().progress( function() {
    $grid.masonry('layout');
  });

  let user_id = <%= @user.id %>;
  $.ajax({
    url: '/users/' + user_id + '.json',
    type: 'GET'
  })
  .done(function(data){
    displayReviews(data);
  });

  function displayReviews(data){
    let container = $(".grid#reviewed-movies");
    let htmlString = "";

    let imageUrl = "https://image.tmdb.org/t/p/w154";

    container.empty();
    //check if the API responds back with an error i.e. no data found.
    if (data["reviews"].length == 0) {
      htmlString = `<div class="alert alert-danger text-center" role="alert">No Data Found!</div>`
    }
    else{
      data["reviews"].forEach(function(review){
        htmlString += `
                      <div class="grid-item mp-margin">
                        <a href="/movies/${review["movie"]["id"]}">
                          <div class="movie-image">
                           <img src=${review["movie"]["poster"] == null ? "https://goo.gl/p8zDGq" : imageUrl + review["movie"]["poster"]} >
                          </div>
                          <div class="movie-name text-center">
                            <p>${review["movie"]["title"]}</p>
                          </div>
                        </a>
                      </div>
                      `
      });
    }
    container.append(htmlString);
    container.masonry('reloadItems');

    container.imagesLoaded(function(){
      container.masonry('layout');
    });
  }
</script>
